<!DOCTYPE html>
<html>

  <head>
    <%= render "partials/head" %>
  </head>

  <body class="antialiased bg-background text-foreground">
    <!-- Sidebar Overlay for Mobile -->
    <div class="fixed inset-0 z-30 hidden bg-black/50 lg:hidden" id="sidebar_overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <%= render "partials/raw/sidebar" %>

    <!-- Main Content Wrapper -->
    <div class="flex flex-1">
      <!-- Main Content Area -->
      <div class="flex flex-col flex-1 min-h-screen lg:ml-64">
        <!-- Header -->
        <header class="sticky top-0 z-20 flex h-16 shrink-0 items-center gap-x-4 border-b border-border bg-background px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8">
        <!-- Mobile menu button -->
        <button type="button" class="lg:hidden -m-2.5 p-2.5 text-muted-foreground" onclick="toggleSidebar()">
          <span class="sr-only">Open sidebar</span>
          <i class="ki-filled ki-menu text-xl"></i>
        </button>

        <!-- Separator -->
        <div class="h-6 w-px bg-border lg:hidden" aria-hidden="true"></div>

        <div class="flex flex-1 gap-x-4 self-stretch lg:gap-x-6">
          <div class="flex flex-1 items-center">
            <h1 class="text-lg font-semibold text-foreground">
              <%= content_for(:page_title) || "Dashboard" %>
            </h1>
          </div>

          <div class="flex items-center gap-x-4 lg:gap-x-6">
            <!-- Profile dropdown -->
            <div class="relative">
              <button type="button" class="flex items-center gap-x-4 text-sm font-semibold leading-6 text-foreground hover:text-primary" id="user-menu-button" aria-expanded="false" aria-haspopup="true">
                <span class="sr-only">Open user menu</span>
                <i class="ki-filled ki-user text-xl"></i>
                <span class="hidden lg:block"><%= current_account&.person&.name || current_account&.email || 'User' %></span>
                <i class="ki-filled ki-down text-sm"></i>
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="flex-1 py-6">
        <div class="px-4 sm:px-6 lg:px-8">
          <% if notice.present? %>
            <div class="mb-4">
              <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg">
                <div class="flex items-center">
                  <i class="ki-filled ki-check-circle text-green-600 mr-2"></i>
                  <p class="text-sm font-medium"><%= notice %></p>
                </div>
              </div>
            </div>
          <% end %>

          <% if alert.present? %>
            <div class="mb-4">
              <div class="bg-destructive/10 border border-destructive text-destructive px-4 py-3 rounded-lg">
                <div class="flex items-center">
                  <i class="ki-filled ki-information text-destructive mr-2"></i>
                  <p class="text-sm font-medium"><%= alert %></p>
                </div>
              </div>
            </div>
          <% end %>

          <%= yield %>
        </div>
      </main>
    </div>
  </div>

  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar_overlay');

      if (sidebar.classList.contains('-translate-x-full')) {
        // Open sidebar
        sidebar.classList.remove('-translate-x-full');
        overlay.classList.remove('hidden');
      } else {
        // Close sidebar
        sidebar.classList.add('-translate-x-full');
        overlay.classList.add('hidden');
      }
    }

    function closeSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar_overlay');

      sidebar.classList.add('-translate-x-full');
      overlay.classList.add('hidden');
    }
  </script>
</body>
</html>
