<!--
  Template: show.html.erb
  Tujuan: Halaman show untuk Issue nested pada Customer.
  Catatan: Mengasumsikan controller menyediakan @customer dan @issue.
-->

<%# Bangun actions_html untuk menghindari nested ERB dalam render %>
<% actions_html = capture do %>
  <%= link_to edit_protected_customer_issue_path(@customer, @issue), class: 'kt-btn kt-btn-outline' do %>
    <i class="ki-filled ki-pencil"></i> Edit Issue
  <% end %>
  <%= link_to protected_customer_issues_path(@customer), class: 'kt-btn kt-btn-outline' do %>
    <i class="ki-filled ki-arrow-left"></i> Kembali ke Issues Customer
  <% end %>
<% end %>

<%= render 'protected/shared/partials/page_header',
  title: 'Detail Issue',
  subtitle: (@customer&.respond_to?(:person_name) ? @customer.person_name : 'Customer'),
  actions_html: actions_html %>

<%= render partial: 'protected/issues/customers/partials/details',
      locals: {
        record: (@issue || nil),
        namespace: :protected,
        customer: @customer
      } %>

<%# Komentar Issue %>
<%= render partial: 'protected/issues/customers/partials/comments' %>

<%# Aktivitas Issue %>
<%= render partial: 'protected/issues/customers/partials/activities' %>