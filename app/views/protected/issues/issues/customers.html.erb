<h1>Customer Issues</h1>

<%#= link_to 'New Issue', new_protected_issues_issue_path, class: 'btn btn-primary mb-3' %>

<% if @issues.any? %>
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Title</th>
          <th>Status</th>
          <th>Priority</th>
          <th>Customer</th>
          <th>Assigned To</th>
          <th>Created At</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @issues.each do |issue| %>
          <tr>
            <td><%= issue.title %></td>
            <td>
              <span class="badge <%= issue.open? ? 'bg-success' : issue.in_progress? ? 'bg-warning' : 'bg-secondary' %>">
                <%= issue.status&.humanize || 'Unknown' %>
              </span>
            </td>
            <td>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= @issue.high? ? 'bg-red-100 text-red-800' : @issue.medium? ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800' %>">
              <%= @issue.priority&.humanize || 'Unknown' %>
            </span>
            </td>
            <td>
              <% if issue.issueable %>
                <%= issue.issueable.person_name %>
              <% else %>
                N/A
              <% end %>
            </td>
            <td>
              <% if issue.assigned_to %>
                <%= issue.assigned_to.person_name %>
              <% else %>
                Unassigned
              <% end %>
            </td>
            <td><%= l(issue.created_at) %></td>
            <td>
              <%= link_to 'Show', protected_issues_issue_path(issue), class: 'btn btn-sm btn-info' %>
              <%= link_to 'Edit', edit_protected_issues_issue_path(issue), class: 'btn btn-sm btn-warning' %>
              <%= link_to 'Destroy', protected_issues_issue_path(issue), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-sm btn-danger' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p class="text-muted">No customer issues found.</p>
<% end %>

<%= link_to 'Back to Dashboard', protected_dashboard_path, class: 'btn btn-secondary' %>