<%#
  Partial: Devices Form (Unified)
  Tujuan: Satu partial form untuk halaman New/Edit Device.
  Prinsip: DRY, SRP, KISS — menerima local `device` dan membuat `form_with` internal.
  Pemakaian:
    <%= render 'protected/devices/form', device: @device %>


<%= form_with(model: [:protected, device], local: true) do |form| %>
  <% if device.errors.any? %>
    <div class="bg-destructive/10 border border-destructive text-destructive px-4 py-3 rounded-lg">
      <div class="flex gap-3">
        <div class="flex-shrink-0">
          <i class="ki-filled ki-information text-destructive text-lg"></i>
        </div>
        <div>
          <h3 class="text-sm font-medium text-destructive">
            <%= pluralize(device.errors.count, "error") %> prohibited this device from being saved:
          </h3>
          <div class="mt-2 text-sm text-destructive">
            <ul role="list" class="list-disc pl-5 space-y-1">
              <% device.errors.each do |error| %>
                <li><%= error.full_message %></li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="grid gap-6">
    <div class="kt-card">
      <div class="kt-card-header">
        <h3 class="kt-card-title">Informasi Perangkat</h3>
      </div>
      <div class="kt-card-content">
        <%= kt_grid(cols: 1, cols_md: 2, gap: 4) do %>
          <div>
            <%= form.label :label, 'Label Perangkat', class: 'form-label' %>
            <%= form.text_field :label,
                class: 'kt-input',
                placeholder: 'Contoh: MacBook Pro 16-inch',
                required: true %>
            <p class="mt-1 text-sm text-secondary-foreground">Nama deskriptif untuk perangkat.</p>
          </div>

          <div>
            <%= form.label :device_type_id, 'Tipe Perangkat', class: 'form-label' %>
            <%= form.select :device_type_id,
                options_for_select(@device_types.map { |dt| [dt.name, dt.id] }, device.device_type_id),
                { include_blank: 'Pilih tipe perangkat…' },
                class: 'kt-input',
                required: true %>
            <p class="mt-1 text-sm text-secondary-foreground">Kategori perangkat.</p>
          </div>

          <div>
            <%= form.label :serial_number, 'Nomor Seri', class: 'form-label' %>
            <%= form.text_field :serial_number,
                class: 'kt-input',
                placeholder: 'Masukkan nomor seri perangkat',
                required: true %>
            <p class="mt-1 text-sm text-secondary-foreground">Identifier unik untuk pelacakan.</p>
          </div>

          <div>
            <%= form.label :model, 'Model', class: 'form-label' %>
            <%= form.text_field :model,
                class: 'kt-input',
                placeholder: 'Contoh: MacBook Pro 16-inch' %>
            <p class="mt-1 text-sm text-secondary-foreground">Spesifikasi model perangkat.</p>
          </div>

          <div>
            <%= form.label :firmware_version, 'Versi Firmware', class: 'form-label' %>
            <%= form.text_field :firmware_version,
                class: 'kt-input',
                placeholder: 'Contoh: 1.2.3' %>
            <p class="mt-1 text-sm text-secondary-foreground">Versi firmware saat ini.</p>
          </div>

          <div>
            <%= form.label :status, 'Status Awal', class: 'form-label' %>
            <%= form.select :status,
                options_for_select(Device.statuses.keys.map { |s| [s.humanize, s] }, device.status || 'available'),
                {},
                class: 'kt-input' %>
            <p class="mt-1 text-sm text-secondary-foreground">Setel status ketersediaan.</p>
          </div>
        <% end %>
      </div>
    </div>

    <%= kt_card_footer(justify: 'justify-end', class_name: 'gap-3') do %>
      <%= link_to protected_devices_path, class: 'kt-btn kt-btn-outline' do %>
        <i class="ki-filled ki-cross"></i>
        Batal
      <% end %>

      <%= form.submit (device.new_record? ? 'Simpan Perangkat' : 'Perbarui Perangkat'),
          class: 'kt-btn kt-btn-primary',
          data: { disable_with: device.new_record? ? 'Menyimpan...' : 'Memperbarui...' } %>
    <% end %>
  </div>
<% end %>
